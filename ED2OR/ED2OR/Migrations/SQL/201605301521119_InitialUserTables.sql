DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'ED2OR.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201605301521119_InitialUserTables'
BEGIN
    CREATE TABLE [dbo].[AspNetRoles] (
        [Id] [nvarchar](128) NOT NULL,
        [Name] [nvarchar](256) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetRoles] PRIMARY KEY ([Id])
    )
    CREATE UNIQUE INDEX [RoleNameIndex] ON [dbo].[AspNetRoles]([Name])
    CREATE TABLE [dbo].[AspNetUserRoles] (
        [UserId] [nvarchar](128) NOT NULL,
        [RoleId] [nvarchar](128) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetUserRoles] PRIMARY KEY ([UserId], [RoleId])
    )
    CREATE INDEX [IX_UserId] ON [dbo].[AspNetUserRoles]([UserId])
    CREATE INDEX [IX_RoleId] ON [dbo].[AspNetUserRoles]([RoleId])
    CREATE TABLE [dbo].[AspNetUsers] (
        [Id] [nvarchar](128) NOT NULL,
        [Email] [nvarchar](256),
        [EmailConfirmed] [bit] NOT NULL,
        [PasswordHash] [nvarchar](max),
        [SecurityStamp] [nvarchar](max),
        [PhoneNumber] [nvarchar](max),
        [PhoneNumberConfirmed] [bit] NOT NULL,
        [TwoFactorEnabled] [bit] NOT NULL,
        [LockoutEndDateUtc] [datetime],
        [LockoutEnabled] [bit] NOT NULL,
        [AccessFailedCount] [int] NOT NULL,
        [UserName] [nvarchar](256) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetUsers] PRIMARY KEY ([Id])
    )
    CREATE UNIQUE INDEX [UserNameIndex] ON [dbo].[AspNetUsers]([UserName])
    CREATE TABLE [dbo].[AspNetUserClaims] (
        [Id] [int] NOT NULL IDENTITY,
        [UserId] [nvarchar](128) NOT NULL,
        [ClaimType] [nvarchar](max),
        [ClaimValue] [nvarchar](max),
        CONSTRAINT [PK_dbo.AspNetUserClaims] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_UserId] ON [dbo].[AspNetUserClaims]([UserId])
    CREATE TABLE [dbo].[AspNetUserLogins] (
        [LoginProvider] [nvarchar](128) NOT NULL,
        [ProviderKey] [nvarchar](128) NOT NULL,
        [UserId] [nvarchar](128) NOT NULL,
        CONSTRAINT [PK_dbo.AspNetUserLogins] PRIMARY KEY ([LoginProvider], [ProviderKey], [UserId])
    )
    CREATE INDEX [IX_UserId] ON [dbo].[AspNetUserLogins]([UserId])
    ALTER TABLE [dbo].[AspNetUserRoles] ADD CONSTRAINT [FK_dbo.AspNetUserRoles_dbo.AspNetRoles_RoleId] FOREIGN KEY ([RoleId]) REFERENCES [dbo].[AspNetRoles] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[AspNetUserRoles] ADD CONSTRAINT [FK_dbo.AspNetUserRoles_dbo.AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[AspNetUserClaims] ADD CONSTRAINT [FK_dbo.AspNetUserClaims_dbo.AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
    ALTER TABLE [dbo].[AspNetUserLogins] ADD CONSTRAINT [FK_dbo.AspNetUserLogins_dbo.AspNetUsers_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[AspNetUsers] ([Id]) ON DELETE CASCADE
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201605301521119_InitialUserTables', N'ED2OR.Migrations.Configuration',  0x1F8B0800000000000400DD5CDB6EE336107D2FD07F10F4D416A99538DDC536B077913A491B7473C13A5BF46D414BB423AC44A912954D50F4CBFAD04FEA2F742851375E74B115DB290A146B717866381C92C3D151FEFDFB9FC9BB47DF331E7014BB01999A47A343D3C0C40E1C97ACA6664297DFBF31DFBDFDFAABC9B9E33F1ABFE572C74C0E7A92786ADE531A9E58566CDF631FC523DFB5A3200E96746407BE859CC01A1F1EFE681D1D5918204CC0328CC9878450D7C7E90FF8390B888D439A20EF2A70B017F3E7D0324F518D6BE4E33844369E9AE767E39B0FA34CCE344E3D17810D73EC2D4D0311125044C1C2938F319ED32820AB79080F9077F71462905B222FC6DCF29352BCEB200EC76C1056D93187B29398067E4FC0A363EE154BECBE966FCDC26BE0B773F02F7D62A34E7D37352F1D9C3EFA1078E00051E1C9CC8B98F0D4BC2A549CC6E135A6A3BCE32883BC8800EE4B107D1E55110F8CCEFD0E8A281A8F0ED97F07C62CF16812E129C1098D907760DC260BCFB57FC54F77C1674CA6C7478BE5F19B57AF9173FCFA077CFCAA3A52182BC8D51EC0A3DB28087104B6E165317ED3B0EAFD2CB163D1ADD227F30AC4122C08D3B8428FEF3159D17B582AE337A671E13E62277FC283EB237161FD40271A25F0F33AF13CB4F070D16E35EA64FF6FD03A7EF57A10ADD7E8C15DA5532FE8878513C1BAFA80BDB435BE77C36C79D5E6FB1317BB88029FFDAEC757D6FA691E2491CD06136845EE50B4C2B46EDDC42A83B7534833A8E1C33A47DDFFD06696CAE1AD1465035A6725E42AB6BD1A727B9F576FE7883B0D4398BC34B498479A02AE7A4C8D847E0746DA5A86CB51D77021308CFFF3EE77EE23D71B60FBEBA005728EA51BF9B818E54F01041B22BD6DBE45710CABDFF905C5F70DA6C33F07307D8EED2482A09C53E487CFAEEDF63E20F83AF1172CD6B7A76BB0A9B9FB125C209B06D13961BD36C67B1FD89F83849E13E70C51FC91DA3920FB79E7FADD010631E7D4B6711C5F4030636716404A9D035E127A3CEE0DC7B6A65DA71F330FB9BE3AFF1036D14FB9689983A825A43C4423A6CA459A4C7D1FAC5CD2CDD45C546F6A26D16A2A17EB6B2A03EB662997D41B9A0AB4DA99490D96DDA533347C7A97C2EE7F7EB7D9E1ADDB0B2A6E9CC30E897FC60447B08D39B788521C917206BAEC1BBB4816D2E9634A9FFD6C4A35FD86BC6468556BAD867413187E35A4B0FBBF1A5233E1F183EBB0ACA4C3A5271706F84EF2EAFB54FB9A132CDBF672A80D73DBCAB7B307E896CB691C07B69BAE0245B98B172BEAF6430E67B4572EB2D188D50F181804BACB8E3C78026333C5A0BA2167D8C3141BA776560E9CA1D8468EEC461890D3C3B0FC445518565641EAC67D27E98448C711EB84D825288695EA122A2F0B97D86E88BC562F093D3B1E616CEC850EB1E50C87983085AD9EE8A25C5DF46006147A844969F3D0C4AA445C73206AB256DD9CB7A5B0E5BC4BB588ADC4644BEEAC894B9EBF3D4B60367B6C0BC1D9EC922E06680B78BB08507E57E91A00E2C565DF0254B831690294A7545B09D0BAC77610A07597BCB800CDAEA85DE75FB8AFEE5B78D62FCADB3FD61BDDB583D8ACF963CF4233CB3DA10F851E3892C3F36CC11AF123555CCEC04E7E3F8B79AA2B8608039F635A2FD994F9AE320FB59A41C4206A022C03AD0594BFFA9380A405D5C3B8BC96D7681DCF227AC0E675B74658BEF70BB0951890B1ABAF402B82FA17A5627076BA7D14232BA2410AF24E97850A8E2220C4CDAB3EF00E4ED1D56565C774C985FB64C39581F1C96870504BE6AA71523E98C1BD948766BB975409599F946C232F09E993C64BF96006F7128FD176272992821E69C1462EAA1FE1032DB6BCD2519C3645DBC4CA3851FCC1C4D290A72657280C5DB2AA90A9F813639E31A966DFCFFB138DFC0CC3B26305DFA8B0B6D0448308ADB0D00AAAC1D20B378AE919A26881589D67E6F89298F26CD56CFFB9CAEAF1294F627E0EE4D2ECDFFCA570F5857DED9495D310DEFB02C6E6B35C262DA02B665EDDDD60B436E4A14851B39F055EE2137D6AA5EF9DBDB9ABF6CF9EC808134BB05F4A9D243F49096EDDE99DA6445E0E1B4F4F91B3AC3F457A089DA3F38CB3EA6A5D16AA47C98B5255145DA16A6753A64B5E3A4E939811F69FA55684E7594B9C865205E08F7A6254980C1258A5AD3B6A9D6C52C5ACB774471418255548A1A9879555DE48CDC86AC35A781A8FAA25BA6B9099225574B9B53BB2823352855634AF81ADB0596CEB8EAAA095548115CDDDB14B8E89B87DEEF169A5BDA7AC715C6597D8CDCE2B0DC6F3EC85C31C779577F555A0CAE39E58FC6DBC04C69FEF651C696F726BC45156B5D82C8E3418FADDA6F67EBBBED934BE94D763D65E5AD736F4A697F67ABC7ED1FAAC31215DE14491427B719513AE6C137E7D6AFF2846BA4F6522A691BB110EF3A798627FC40446F33FBC99E762B675E7025788B84B1CD38CA8618E0F8FC6C2D735FBF3A58B15C78EA7B87EEA3E77A9CFD9163857E40145F63D8A6406C4065F8394A05271F99238F8716AFE99F63A49EB14EC5FE9E303E332FE48DC3F1268B88B126CFC25333A8761C7375FA9F6F45B86EE5EBDFCFD53D6F5C0B88960C59C1887822FD799E1FA170EBDACC9BA6E60CDDADF3DBCDC0555FBC040892A2C88F5BF2758B874906F09722BBFF1D1E3B77D4D537E2FB011A2E29B80A1F00671A18EF3BF0E9696EFEFC04F9AF2FDFB0D56CDFF5FC7342DF7DF25FDC144E67FF76D28EFB9C3A346711BDAC69694FAB99539BD118D72D7679344B0DE68A1CB24EA1E701B10A5D7888C17C6311EEC7454508807C3DE65683F3B6F785FA8C2258963B70CE16D92821B5E02FDAFB8C07BC05E53B07176CFF8DD76ACE92AB87B4E9BECC7EBDDB360E31CADDDB377B71D6CBA32EF9E075B2F8EEE9EC5DAAECECF1D475AE72374E78C5B993CA47913A3AA05B7316AB3C239DCF0170104419651661F42AA295C4DF4D31685A5885EA99E3B262A96168EA457926856DB6FACFCC06F1C2C976956AB615C36E9E6FB7FA36E2ED3AC5BC363DC051758C92454F1B35BF6B126CAD34BE2FED646D242356FCB591B5FABBF24AAEF204EA9AD1ECD3BE297C3EC1DC425432E9D1E4C5EF9752F9C9D95BF9408E777ECAE4A08F6771309B66BA76621734996417E780B16E5224285E60A53E4C0917A1A5177896C0ACDACC69C7EC99DD6EDD89B8E05762EC94D42C384C290B1BFF06A052F960434E94FE9CA759B273761FA474986180298E9B2DAFC0DF929713DA7B0FB425113D240B0EC825774D95C5256D95D3D1548D701E908C4DD57244577D80F3D008B6FC81C3DE0756C83F07B8F57C87E2A2B803A90F689A8BB7D72E6A25584FC986394FDE127C4B0E33FBEFD0F8AD38AEB30540000 , N'6.1.3-40302')
END

